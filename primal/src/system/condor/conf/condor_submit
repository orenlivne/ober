#!/bin/bash
####################################################
# A wrapper around Condor submissions of jobs,
# especially those generated by Galaxy.
#
# Oren Livne
# 2011-10-05
####################################################
 
SUBMIT_FILE=$1
OPTS_FILE=$CONDOR_CONF/condor-options
date=`date +'%H-%M-%S'`
TMP="/tmp/condor-$date"

# Log some run information
echo "Starting run at $date" > $TMP.log
echo "Running as user " `whoami` >> $TMP.log
echo "Submit file: $SUBMIT_FILE" >> $TMP.log
echo "Original submit file:" >> $TMP.log
echo "=================================" >> $TMP.log
cat $SUBMIT_FILE >> $TMP.log

# Prepend additional condor options to the
# Condor submit file (this file might have been generated
# by Galaxy)
echo "Appending custom Condor options to submit file..."
rm -rf $TMP.tmp
cat $OPTS_FILE $1 > $TMP.tmp
mv $TMP.tmp $SUBMIT_FILE

# Submit to the Condor pool
echo "Submitting to Condor..."
$CONDOR_HOME/bin/condor_submit $SUBMIT_FILE
